<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Anno117 Color Helper</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:18px;color:#111}
    h1{font-size:18px;margin-bottom:6px}
    .row{display:flex;gap:12px;align-items:center;margin:10px 0}
    .box{width:120px;height:60px;border-radius:6px;border:1px solid #ccc}
    label{display:block;font-size:13px;margin-bottom:4px}
    input[type="number"], input[type="text"]{padding:6px;font-size:13px;width:140px}
    input[type="color"]{width:48px;height:36px;padding:0;border:0}
    button{padding:6px 10px;font-size:13px}
    pre{background:#f7f7f8;padding:10px;border-radius:6px;overflow:auto}
    .col-block{display:flex;flex-direction:column;gap:6px}
    .small{font-size:12px;color:#555}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  </style>
</head>
<body>
  <h1>Anno 117 — Color Helper</h1>
  <p class="small">Wähle UI- und In-Game-Farben, sieh die sichtbare Vorschau und erhalte die ARGB signed 32-bit Integer-Werte (für XML).</p>

  <div class="grid">
    <div>
      <h2 style="font-size:15px;margin:6px 0">Participant UI Color</h2>
      <div class="row">
        <input id="uiColorPicker" type="color" value="#249400">
        <div class="col-block">
          <label>Preview</label>
          <div id="uiPreview" class="box"></div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Alpha (0-255)</label>
          <input id="uiA" type="number" min="0" max="255" value="255">
        </div>
        <div>
          <label>Hex / RGB</label>
          <input id="uiHex" type="text" value="#249400">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Signed ARGB Integer</label>
          <input id="uiInt" type="text" readonly>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button id="uiCopyInt">Copy int</button>
          <button id="uiCopyXML">Copy XML snippet</button>
        </div>
      </div>
    </div>

    <div>
      <h2 style="font-size:15px;margin:6px 0">Participant In-Game Color</h2>
      <div class="row">
        <input id="gameColorPicker" type="color" value="#1f6a1f">
        <div class="col-block">
          <label>Preview</label>
          <div id="gamePreview" class="box"></div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Alpha (0-255)</label>
          <input id="gameA" type="number" min="0" max="255" value="255">
        </div>
        <div>
          <label>Hex / RGB</label>
          <input id="gameHex" type="text" value="#1f6a1f">
        </div>
      </div>

      <div class="row">
        <div>
          <label>Signed ARGB Integer</label>
          <input id="gameInt" type="text" readonly>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button id="gameCopyInt">Copy int</button>
          <button id="gameCopyXML">Copy XML snippet</button>
        </div>
      </div>
    </div>
  </div>

  <h3 style="margin-top:18px">Combined XML snippet (ready for Anno 117)</h3>
  <pre id="xmlOut">&lt;ParticipantColor&gt;
  &lt;ParticipantUIColor&gt;
    &lt;Deuteranopia&gt;...&lt;/Deuteranopia&gt;
    &lt;Protanopia&gt;...&lt;/Protanopia&gt;
    &lt;Tritanopia&gt;...&lt;/Tritanopia&gt;
    &lt;None&gt;...&lt;/None&gt;
  &lt;/ParticipantUIColor&gt;
  &lt;ParticipantInGameColor&gt;
    &lt;Deuteranopia&gt;...&lt;/Deuteranopia&gt;
    &lt;Protanopia&gt;...&lt;/Protanopia&gt;
    &lt;Tritanopia&gt;...&lt;/Tritanopia&gt;
    &lt;None&gt;...&lt;/None&gt;
  &lt;/ParticipantInGameColor&gt;
&lt;/ParticipantColor&gt;</pre>

  <script>
    // helpers
    function hexToRgb(hex){
      hex = hex.replace('#','');
      if(hex.length===3) hex = hex.split('').map(c=>c+c).join('');
      const bigint = parseInt(hex,16);
      return {r:(bigint>>16)&255, g:(bigint>>8)&255, b:bigint&255};
    }
    function argbToSignedInt(a,r,g,b){
      const val = ((a&0xff)<<24) | ((r&0xff)<<16) | ((g&0xff)<<8) | (b&0xff);
      // convert to signed 32-bit
      return val>>>0; // unsigned
    }
    function signed32FromArgb(a,r,g,b){
      const u = argbToSignedInt(a,r,g,b);
      // js bitwise treat as signed when converting via Int32
      const signed = (u & 0x80000000) ? (u - 4294967296) : u;
      return signed;
    }
    function updatePreview(pickerId, previewId, hexId, aId, intId){
      const hex = document.getElementById(pickerId).value;
      const preview = document.getElementById(previewId);
      preview.style.background = hex;
      document.getElementById(hexId).value = hex;
      const rgb = hexToRgb(hex);
      const a = parseInt(document.getElementById(aId).value,10)||255;
      const signed = signed32FromArgb(a,rgb.r,rgb.g,rgb.b);
      document.getElementById(intId).value = signed;
      updateXML();
    }
    function updateXML(){
      const uiInt = document.getElementById('uiInt').value || '0';
      const gameInt = document.getElementById('gameInt').value || '0';
      const xml = `<ParticipantColor>\n  <ParticipantUIColor>\n    <Deuteranopia>${uiInt}</Deuteranopia>\n    <Protanopia>${uiInt}</Protanopia>\n    <Tritanopia>${uiInt}</Tritanopia>\n    <None>${uiInt}</None>\n  </ParticipantUIColor>\n  <ParticipantInGameColor>\n    <Deuteranopia>${gameInt}</Deuteranopia>\n    <Protanopia>${gameInt}</Protanopia>\n    <Tritanopia>${gameInt}</Tritanopia>\n    <None>${gameInt}</None>\n  </ParticipantInGameColor>\n</ParticipantColor>`;
      document.getElementById('xmlOut').textContent = xml;
    }

    // initial
    updatePreview('uiColorPicker','uiPreview','uiHex','uiA','uiInt');
    updatePreview('gameColorPicker','gamePreview','gameHex','gameA','gameInt');

    // listeners
    document.getElementById('uiColorPicker').addEventListener('input',()=>updatePreview('uiColorPicker','uiPreview','uiHex','uiA','uiInt'));
    document.getElementById('gameColorPicker').addEventListener('input',()=>updatePreview('gameColorPicker','gamePreview','gameHex','gameA','gameInt'));
    document.getElementById('uiA').addEventListener('input',()=>updatePreview('uiColorPicker','uiPreview','uiHex','uiA','uiInt'));
    document.getElementById('gameA').addEventListener('input',()=>updatePreview('gameColorPicker','gamePreview','gameHex','gameA','gameInt'));
    document.getElementById('uiHex').addEventListener('change',function(){document.getElementById('uiColorPicker').value=this.value; updatePreview('uiColorPicker','uiPreview','uiHex','uiA','uiInt')});
    document.getElementById('gameHex').addEventListener('change',function(){document.getElementById('gameColorPicker').value=this.value; updatePreview('gameColorPicker','gamePreview','gameHex','gameA','gameInt')});

    // copy buttons
    document.getElementById('uiCopyInt').addEventListener('click',()=>navigator.clipboard.writeText(document.getElementById('uiInt').value));
    document.getElementById('gameCopyInt').addEventListener('click',()=>navigator.clipboard.writeText(document.getElementById('gameInt').value));
    document.getElementById('uiCopyXML').addEventListener('click',()=>navigator.clipboard.writeText(document.getElementById('xmlOut').textContent));
    document.getElementById('gameCopyXML').addEventListener('click',()=>navigator.clipboard.writeText(document.getElementById('xmlOut').textContent));

    // allow entering signed int and convert back
    function intToHexColor(signed){
      let u = Number(signed);
      if(u < 0) u = 4294967296 + u; // convert to unsigned
      const a = (u>>24)&255; const r=(u>>16)&255; const g=(u>>8)&255; const b=u&255;
      const hex = '#'+[r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');
      return {hex, a, r, g, b};
    }
    document.getElementById('uiInt').addEventListener('dblclick',function(){
      const v = prompt('Enter signed ARGB integer to preview (double-clicked)');
      if(!v) return;
      const res = intToHexColor(Number(v));
      document.getElementById('uiColorPicker').value = res.hex; document.getElementById('uiA').value=res.a; updatePreview('uiColorPicker','uiPreview','uiHex','uiA','uiInt');
    });
    document.getElementById('gameInt').addEventListener('dblclick',function(){
      const v = prompt('Enter signed ARGB integer to preview (double-clicked)');
      if(!v) return;
      const res = intToHexColor(Number(v));
      document.getElementById('gameColorPicker').value = res.hex; document.getElementById('gameA').value=res.a; updatePreview('gameColorPicker','gamePreview','gameHex','gameA','gameInt');
    });

    // show initial ints
    updatePreview('uiColorPicker','uiPreview','uiHex','uiA','uiInt');
    updatePreview('gameColorPicker','gamePreview','gameHex','gameA','gameInt');
  </script>
</body>
</html>
